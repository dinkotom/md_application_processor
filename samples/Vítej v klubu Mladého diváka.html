<!DOCTYPE html>
<html lang="en">
    <head>
    <meta name="csrf-token" content="FI3g1uR7Uf58RvfhdeJToFk2uOqUBDJoEBVal9zO">
    <script>
    function importVue3AssetsClientSide(assetsPath, asset) {
        const account = window.location.host.split('.')[0]

        const shouldLoadStagingManifest = () => {
            try {
                const STAGING_ACCOUNTS = ['hynekdevel', 'vaclavvesely', 'mvan1337']
                if(STAGING_ACCOUNTS.includes(account) || window.location.search.includes('forceStagingAssets')) {
                    console.debug('[Loading staging assets]')
                    return true
                }
            } catch (e) {
            }

            return false
        }
        const getManifestFile = () => {
            if(asset === 'error-pages.ts') {
                return 'manifest-error-pages.json'
            }
            const searchParams = new URLSearchParams(window.location.search)
            const testingAssets = searchParams.get('testingAssets')
            if(!!testingAssets) {
                console.debug('[Loading testing assets] - ', testingAssets)
                return 'manifest-' + testingAssets + '.json'
            }

            return shouldLoadStagingManifest() ? 'manifest-staging.json' : 'manifest.json'
        }
        const manifestFile = getManifestFile()
        fetch(`${assetsPath}/${manifestFile}`)
            .then( r => r.text() )
            .then( t => {
                const manifest = JSON.parse(t)
                const assetFile = manifest['src/' + asset]
                const assetFileFullPath = assetsPath + '/' + assetFile['file']
                var script = document.createElement("script");
                script.src = assetFileFullPath
                script.type = "module"
                document.head.appendChild(script)
                if(assetFile['css']) {
                    for (const cssFile of assetFile['css']) {
                        const assetFileFullPath = assetsPath + '/' + cssFile
                        let link = document.createElement("link");
                        link.href = assetFileFullPath
                        link.rel = "stylesheet"
                        document.head.appendChild(link)
                    }
                }
            } )
    }
</script>
            
            <script>importVue3AssetsClientSide("https://d3hgrlqjaqd5ry.cloudfront.net/app/assets/dist-vue3", "main.ts")</script>
    </head>
    <body id="vueApp">
        <router-view></router-view>
    </body>
</html>
